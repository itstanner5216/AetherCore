{
  "apiVersion": "v1",
  "spec": {
    "kind": "Workflow",
    "spec": {
      "type": "sequential",
      "context": {
        "projectId": "{{ .project.id }}",
        "clusterId": "{{ .cluster.id }}"
      },
      "steps": [
        {
          "kind": "Build",
          "spec": {
            "id": "aethercore-gateway-build",
            "buildSettings": {
              "dockerfile": {
                "buildEngine": "kaniko",
                "dockerfilePath": "/Dockerfile",
                "dockerWorkDir": "/"
              }
            },
            "buildArguments": {}
          }
        },
        {
          "kind": "DeploymentService",
          "spec": {
            "id": "aethercore-gateway",
            "name": "aethercore-gateway",
            "billing": {
              "deploymentPlan": "nf-compute-10"
            },
            "deployment": {
              "instances": 1,
              "docker": {
                "configType": "customCommand",
                "customCommand": "uvicorn gateway:app --host 0.0.0.0 --port 8000 --workers 2"
              },
              "storage": {
                "ephemeralStorage": {
                  "storageSize": 1024
                }
              }
            },
            "ports": [
              {
                "name": "http",
                "internalPort": 8000,
                "public": true,
                "protocol": "HTTP",
                "security": {
                  "policies": []
                }
              }
            ],
            "runtimeEnvironment": {
              "ENVIRONMENT": "production",
              "DEBUG": "false",
              "PORT": "8000",
              "HOST": "0.0.0.0",
              "LOG_LEVEL": "INFO",
              "CORS_ORIGINS": "https://chat.openai.com,https://chatgpt.com",
              "RATE_LIMIT_REQUESTS": "100",
              "RATE_LIMIT_WINDOW": "3600",
              "SKILLS_CONFIG_PATH": "skills_config.json"
            },
            "healthChecks": {
              "livenessProbe": {
                "httpGet": {
                  "path": "/health",
                  "port": 8000,
                  "scheme": "HTTP"
                },
                "initialDelaySeconds": 30,
                "periodSeconds": 10,
                "timeoutSeconds": 5,
                "successThreshold": 1,
                "failureThreshold": 3
              },
              "readinessProbe": {
                "httpGet": {
                  "path": "/health",
                  "port": 8000,
                  "scheme": "HTTP"
                },
                "initialDelaySeconds": 10,
                "periodSeconds": 5,
                "timeoutSeconds": 3,
                "successThreshold": 1,
                "failureThreshold": 3
              }
            }
          }
        }
      ]
    }
  }
}
